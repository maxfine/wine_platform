kmap.loadLeftEnd=new Date().getTime();define("",["$"],function($){$s.wait("kmap_entity_div",function(entity_div){var right_div=entity_div.parentNode,statTypeList=[],kmap_stas_type_cl,cooperation="",businessMap={},kmapRowNum=0;function buildRelation(rel){try{rel=JSON.parse(rel)}catch(e){return }if(!$s.$("kmap_relation_div")||!rel||!rel.nodes||rel.nodes.length<3){return }var outerWrap=$s.$("kmap_relation_div"),innerWrap=$s.$c("div",outerWrap,"vr-tupu"),h3=$s.$c("h3",innerWrap,"rvr-atAdBranch"),p=$s.$c("p",innerWrap,"gx"),div=$s.$c("div",innerWrap,"kj-box"),canvas=$s.$c("canvas",div),dirDiv=$s.$c("div",div,"kj-box2");var width=390,height=185,dirs=["top","left","bottom","right"],ox=oy=0;var lastLoc,clickActive=true,dragging=false;var openCur="url(/tupu/images/handopen.cur),default",closeCur="url(/tupu/images/handclose.cur),default";h3.style.marginTop="0px";if(!canvas.getContext){outerWrap.style.display="none";return }else{outerWrap.style.display=""}canvas.id="kmap_rel";canvas.width=width;canvas.height=height;canvas.onclick=onCanvasClick;canvas.onmousemove=onMouseMove;canvas.onmousedown=onMouseDown;canvas.onmouseup=onMouseUp;var ctx=canvas.getContext("2d");for(var i=0;i<dirs.length;i++){var a=$s.$c("a",dirDiv,"p"+(i+1));a.href="javascript:void(0);";a.id="kmap_rel_dir_"+dirs[i];a.onclick=function(dir){return function(){move(dir)}}(i)}var cur,lastHover=hoverNode=null,main,n1=[],n2=[],nodeMap={},titleLink;processData();if(!main){main={}}titleLink="/tupu/person.html?q="+encodeURIComponent(main.name||"");p.innerHTML='<span class="p1">亲情</span><span class="p2">友情</span><span class="p3">爱情</span><a target="_blank" id="kmap_rel_more" href="'+titleLink+'">查看更多</a>';h3.innerHTML='<a target="_blank" id="kmap_rel_title" href="'+titleLink+'">'+(main.name?main.name+"的关系图谱":"关系图谱")+"</a>";calPos();draw();kmap.kmapPB("person_rel");function processData(){var big=28,small=22,bigAppid="100520136",smallAppid="100520137",appid,serverId;for(var i in rel.nodes){var node=rel.nodes[i];nodeMap[node.id]=node}for(var i in rel.nodes){var node=rel.nodes[i],imgsrc=node.img;if(node.level==0){main=node;main.r=big}else{if(node.level==1){n1.push(node);node.r=small}else{if(node.level==2){n2.push(node);node.r=small}}}node.image=new Image();appid=main==node?bigAppid:bigAppid;serverId=node.id%4+1;imgsrc="http://img0"+serverId+".sogoucdn.com/net/a/"+appid+"/link?appid="+appid+"&url="+encodeURIComponent(imgsrc);imgsrc=kmap.getImgLink(imgsrc);node.image.src=imgsrc;node.link=[];for(var j in rel.links){var link=rel.links[j];if(link.from==node.id&&nodeMap[link.to].level==2&&node.link.length<3){node.link.push(nodeMap[link.to])}}}cur=main}function calPos(){var gap=110,rx=width/2,ry=37,subAngle=[0,-Math.PI/6,Math.PI/6];rx=document.body.className.indexOf("vr1024")>=0?125:rx;main.x=rx;main.y=ry;var n=n1.length<=3?n1.length+1:n1.length-1,begin=n1.length<=3?1:0,end=n1.length<=3?n1.length:n1.length-1;for(var i=begin,index=0;i<=end;i++,index++){var angle=Math.PI+Math.PI*i/n,node=n1[index];node.x=rx+Math.round(gap*Math.cos(angle));node.y=ry-Math.round(gap*Math.sin(angle));node.angle=angle;for(var j in node.link){var subNode=node.link[j];subNode.x=node.x+Math.round((gap+30)*Math.cos(angle+(subAngle[j]||0)));subNode.y=node.y-Math.round((gap+30)*Math.sin(angle+(subAngle[j]||0)))}}}function move(dir){var tx=ty=0,dis=20;if(dir==0){ty+=dis}else{if(dir==1){tx+=dis}else{if(dir==2){ty-=dis}else{if(dir==3){tx-=dis}}}}ox+=tx;oy+=ty;ctx.translate(tx,ty);draw();(new Image()).src=location.protocol+"//pb.sogou.com/cl.gif?uigs_productid=kmap&type=person_rel&uigs_cl=direction&sab="+sab+"&k_uuid="+uuid+"&gbkQuery="+encodeURIComponent(gbkQuery)}function draw(){ctx.clearRect(-ox,-oy,width,height);var links=rel.links,colors=["#f0918f","#5f98f4","#88b566"];for(var i in links){var link=links[i],from=nodeMap[link.from],to=nodeMap[link.to];if(from.y==to.y&&from.level==to.level&&from.level==1){continue}if(cur!=from&&cur!=to){var j=0;for(;j<i;j++){if(links[j].from==link.to&&links[j].to==link.from){break}}if(j>=i){drawDashedLine(ctx,from.x,from.y,to.x,to.y)}}}for(var i in links){var link=links[i],from=nodeMap[link.from],to=nodeMap[link.to];if(from.y==to.y&&from.level==to.level&&from.level==1){continue}if(from==cur){ctx.beginPath();ctx.lineWidth=2;ctx.strokeStyle=colors[link.type];ctx.moveTo(from.x,from.y);ctx.lineTo(to.x,to.y);ctx.closePath();ctx.stroke();ctx.save();ctx.fillStyle=colors[link.type];ctx.textAlign="center";ctx.textBaseline="middle";ctx.font="11px Microsoft Yahei";var w=ctx.measureText(link.name).width+6;ctx.fillRect((from.x+to.x-w)/2,(from.y+to.y-14)/2,w,16);ctx.fillStyle="white";ctx.fillText(link.name,(from.x+to.x)/2,(from.y+to.y)/2);ctx.restore()}}for(var i in nodeMap){var d=nodeMap[i];if(d.image.height){drawNode(d)}else{d.image.onload=function(d){return function(){drawNode(d)}}(d)}}}function drawNode(d){ctx.save();if(d==main){ctx.shadowColor="rgba(0,0,0,1)";ctx.shadowOffsetX=0;ctx.shadowOffsetY=2;ctx.shadowBlur=5;ctx.fillStyle="white";ctx.beginPath();ctx.arc(d.x,d.y,d.r,0,2*Math.PI,true);ctx.closePath();ctx.fill()}ctx.restore();ctx.save();ctx.beginPath();var radius=(hoverNode==d)?d.r+2:d.r;ctx.arc(d.x,d.y,radius+1,0,2*Math.PI,true);ctx.clip();ctx.closePath();var len=Math.min(d.image.height,d.image.width);ctx.drawImage(d.image,0,0,len,len,d.x-radius,d.y-radius,2*radius,2*radius);ctx.restore();ctx.beginPath();ctx.fillStyle=d==main?"white":"#f0f2f3";ctx.arc(d.x,d.y,radius,0,2*Math.PI,true);ctx.arc(d.x,d.y,radius+2,0,2*Math.PI,false);ctx.fill();ctx.closePath();if(hoverNode!=null){var neighbor=null;for(var i in rel.links){var link=rel.links[i];if(nodeMap[link.from]==hoverNode&&nodeMap[link.to]==d){neighbor=d;break}}ctx.save();ctx.fillStyle="rgba(0,0,0,0.45)";ctx.textAlign="center";ctx.textBaseline="middle";ctx.font="11px Microsoft Yahei";var w=ctx.measureText(d.name).width+6;if(hoverNode==d){ctx.fillRect(d.x+d.r,d.y+(-d.r-14)/2,w,16);ctx.fillStyle="white";ctx.fillText(d.name,d.x+d.r+w/2,d.y-d.r/2)}else{if(neighbor!=null){ctx.fillRect(d.x-w/2,d.y+d.r,w,16);ctx.fillStyle="white";ctx.fillText(d.name,d.x,d.y+d.r+14/2)}}ctx.restore()}}function inAnyNode(loc){for(var i in nodeMap){var node=nodeMap[i];if((node.x-loc.x+ox)*(node.x-loc.x+ox)+(node.y-loc.y+oy)*(node.y-loc.y+oy)<node.r*node.r){return node}}return null}function onMouseMove(e){var loc=windowToCanvas(e.clientX,e.clientY);e.preventDefault();if(dragging){if(lastLoc.x==loc.x&&lastLoc.y==loc.y){return }clickActive=false;var tx=loc.x-lastLoc.x,ty=loc.y-lastLoc.y;ox+=tx;oy+=ty;lastLoc=loc;ctx.translate(tx,ty);draw()}else{hoverNode=inAnyNode(loc);if(hoverNode&&cur!=hoverNode){cur=hoverNode;draw()}if(lastHover!=hoverNode){lastHover=hoverNode;draw()}if(hoverNode){canvas.style.cursor="pointer"}else{canvas.style.cursor=openCur}}}function onMouseDown(e){dragging=true;clickActive=true;var loc=windowToCanvas(e.clientX,e.clientY);lastLoc=loc;canvas.style.cursor=closeCur}function onMouseUp(e){dragging=false;canvas.style.cursor=openCur}function onCanvasClick(e){if(!clickActive){return }var loc=windowToCanvas(e.clientX,e.clientY),node=inAnyNode(loc);if(node){window.open("/web"+kmap.splicelink(node.name),"_blank");(new Image()).src=location.protocol+"//pb.sogou.com/cl.gif?uigs_productid=kmap&type=person_rel&query="+encodeURIComponent(node.name)+"&uigs_cl=node&sab="+sab+"&k_uuid="+uuid+"&gbkQuery="+encodeURIComponent(gbkQuery)}}function windowToCanvas(x,y){var bbox=canvas.getBoundingClientRect();return{x:x-bbox.left*(canvas.width/bbox.width),y:y-bbox.top*(canvas.height/bbox.height)}}function drawDashedLine(context,x1,y1,x2,y2,dashLength){context.strokeStyle="#c4c4c4";context.lineWidth=1;context.beginPath();dashLength=dashLength||4;var deltaX=(x2-x1),deltaY=(y2-y1),num;num=Math.floor(Math.sqrt(deltaX*deltaX+deltaY*deltaY)/dashLength);for(var i=0;i<num;i++){context[i%2===0?"moveTo":"lineTo"](x1+(deltaX/num)*i,y1+(deltaY/num)*i)}context.stroke()}}function buildTitle(title,note){var h3=$s.$c("h3",entity_div,"rvr-atAdBranch");h3.title=title||"";title=title?kmap.cutLength(title,40):"";if(entity_div.innerHTML==""){h3.style.marginTop="0"}var contentArr=["<span class='kmapAttrTitle'>"+title+"</span>"];if(note){contentArr.push('<span class="atAdMore atAdMoreLeft">（'+note+"）</span>")}h3.innerHTML=contentArr.join("");return h3}function buildFoldBtn(attrs){var dis_type=1;if(attrs.needLink&&attrs.len>(attrs.row||1)*4){dis_type=2;var a=$s.$c("a",attrs.titleDiv,"rvr-info-box");kmap.hidefocus(a,"展开","#","sgkmap_right_"+kmap_stas_type_cl+"_more");a.onclick=function(e){if(e){e.preventDefault()}else{window.event.returnValue=false}var num=getColumNumPerRow()*(attrs.row||1);var max=getColumNumPerRow()*4;if(attrs.div&&/(^|\s+)kmap-cuts($|\s+)/.test(attrs.div.className)){num=getColumNumPerRow()}if(this.className=="rvr-info-box"){this.className="rvr-info-box btn-hide";this.innerHTML="收起";if(attrs.div){var lis=$s.$$(attrs.div,"li");for(var i=0;i<max&&i<lis.length;i++){var liImg=$s.$$(lis[i],"img")[0];if(liImg.getAttribute("lazysrc")){var imgheight=liImg.getAttribute("imgheight");kmap.imageHandle(liImg,liImg.getAttribute("lazysrc"),75,parseInt(imgheight));liImg.removeAttribute("imgheight");liImg.removeAttribute("lazysrc")}lis[i].style.display=""}for(var i=max;i<lis.length;i++){lis[i].style.display="none"}}}else{this.className="rvr-info-box";this.innerHTML="展开";if(attrs.div){var lis=$s.$$(attrs.div,"li");for(var i=0;i<num&&i<lis.length;i++){lis[i].style.display=""}for(var i=num;i<lis.length;i++){lis[i].style.display="none"}}}return false}}var kmap_timeout=-1;var changeDiv=(function(div,a,row){return function(){if(kmap_timeout!=-1){clearTimeout(kmap_timeout)}kmap_timeout=setTimeout(function(){if(div){if(/(^|\s+)kmap-cuts($|\s+)/.test(div.className)){row=1}var lis=$s.$$(attrs.div,"li"),num=getColumNumPerRow()*row,max=getColumNumPerRow()*4;if(dis_type==1){for(var i=0;i<num&&i<lis.length;i++){var liImg=$s.$$(lis[i],"img")[0];if(liImg.getAttribute("lazysrc")){var imgheight=liImg.getAttribute("imgheight");kmap.imageHandle(liImg,liImg.getAttribute("lazysrc"),75,parseInt(imgheight));liImg.removeAttribute("imgheight");liImg.removeAttribute("lazysrc")}lis[i].style.display=""}for(var i=num;i<lis.length;i++){lis[i].style.display="none"}}else{if(dis_type==2){if(a.className=="rvr-info-box"){for(var i=0;i<num&&i<lis.length;i++){var liImg=$s.$$(lis[i],"img")[0];if(liImg.getAttribute("lazysrc")){var imgheight=liImg.getAttribute("imgheight");kmap.imageHandle(liImg,liImg.getAttribute("lazysrc"),75,parseInt(imgheight));liImg.removeAttribute("imgheight");liImg.removeAttribute("lazysrc")}lis[i].style.display=""}for(var i=num;i<lis.length;i++){lis[i].style.display="none"}}else{var lis=$s.$$(div,"li");for(var i=0;i<max&&i<lis.length;i++){var liImg=$s.$$(lis[i],"img")[0];if(liImg.getAttribute("lazysrc")){var imgheight=liImg.getAttribute("imgheight");kmap.imageHandle(liImg,liImg.getAttribute("lazysrc"),75,parseInt(imgheight));liImg.removeAttribute("imgheight");liImg.removeAttribute("lazysrc")}lis[i].style.display=""}for(var i=max;i<lis.length;i++){lis[i].style.display="none"}}}}}kmap_timeout=-1},100)}})(attrs.div,a,attrs.row||1);if(!$s.ua.ios&&!$s.ua.and){$s.$b(window,["resize"],[changeDiv])}}function buildKmapList(obj,listloc,title,word,id,name,total,stattype,requery,maskFlag,businessPosition){if(kmap.first(obj,"heat")){buildEnergyMap(obj,title);return }var lis=kmap.all(obj,"element"),lens=lis.length,showRow=kmap.attr(obj,"row");if(kmapRowNum>=4){return }else{if(kmapRowNum==3){showRow=1}}var numPerRow=getColumNumPerRow();if(showRow&&showRow!=1){if(parseInt(numPerRow)*parseInt(showRow)>parseInt(lens)){showRow=Math.floor(parseInt(lens)/parseInt(numPerRow))}}kmapRowNum+=parseInt(showRow||1);var filter=0;if(typeof (window.kmap_top_entity_type)!="undefined"&&filter==0){filter=kmap_top_entity_type}if(!(title==filter||(word==filter&&word!=""))){var powerquery=kmap.attr(obj,"powerquery"),powerid=kmap.attr(obj,"powerid"),note=kmap.attr(obj,"note"),addname=kmap.attr(obj,"addname"),imgtype=kmap.attr(obj,"imgtype");id=powerid?powerid:id;var titleDiv=buildTitle(title,note);if(addname){var titleSpan=$s.$$(titleDiv,"span");titleSpan[0].innerHTML+='<span class="business">&nbsp;-&nbsp;'+addname+"</span>";if(!cooperation){cooperation=encodeURIComponent(addname)}}var ul=$s.$c("ul",entity_div,"rvr-atAdPiclist"),classname="rvr-atpic2",imgheight=75;word=word?word:title;var queryword=powerquery?powerquery:(name+((word=="猜您喜欢")?"":" "+word));var filteredNum=0;for(var i=0;i<lens;i++){var attrname=kmap.attr(lis[i],"name").replace(/&apos;/g,"'");if(businessMap[attrname]){filteredNum++;continue}var li=$s.$c("li",ul),rep_div=$s.$c("div",li,"repDiv rep_Feed"),attrname=kmap.attr(lis[i],"name").replace(/&apos;/g,"'"),wholename=kmap.attr(lis[i],"allname"),addmess=kmap.attr(lis[i],"add"),score=kmap.attr(lis[i],"score"),ptype=kmap.attr(lis[i],"ptype"),baikeurl=kmap.attr(lis[i],"baikeurl"),docid=kmap.attr(lis[i],"docid"),docurl=kmap.attr(lis[i],"docurl"),picSrc=kmap.attr(lis[i],"picaddress"),clickid=kmap.attr(lis[i],"sg2oids"),wholequery=wholename?(wholename.replace(/&apos;/g,"'")):(attrname+(addmess?" "+addmess:"")),a,img;if(i-filteredNum>=numPerRow*(showRow||1)){li.style.display="none"}rep_div.style.marginBottom="5px";var wronga=kmap.feedlink(rep_div,"rvr-atReport",oldQuery+"_"+title+"_"+attrname+"_right","纠错",true,true);wronga.id="sgkmap_right_"+id+"_"+kmap.attr(lis[i],"nameid")+"_"+listloc+"_l"+i+"_wrong";wronga.setAttribute("con",attrname);if(addname){businessPosition=encodeURIComponent(addname)}li.id=["sgkmap_right",businessPosition,kmap_stas_type_cl,stattype,listloc+1,i+1].join("_");var linkurl=kmap.attr(lis[i],"link");if(!(linkurl&&addname)){linkurl=(requery)?kmap.splicelink(wholequery,null,null,1):kmap.splicelink(wholequery,id,kmap.attr(lis[i],"nameid"),1,(word)?word:title,i)}var imgspan=$s.$c("a",li,classname+" rim-pic");imgspan.href=linkurl;imgspan.target="_blank";a=$s.$c("a",li);a.href=linkurl;a.target="_blank";img=$s.$c("img",imgspan);if(wholename){a.title=wholename.replace(/&apos;/g,"'");img.title=wholename.replace(/&apos;/g,"'")}var aspan=$s.$c("span",a,"kmap-title");aspan.innerHTML=kmap.cutLength(attrname,24);if(kmap.attr(lis[i],"year")){var yearSpan=$s.$c("span",li,"kmap-year");yearSpan.innerHTML=(" "+kmap.cutLength(kmap.attr(lis[i],"year"),24))}else{if(kmap.attr(lis[i],"type")){li.innerHTML+=(" "+kmap.cutLength(kmap.attr(lis[i],"type"),24))}}var img1=$s.$$(li,"img")[0];if(i-filteredNum>=numPerRow*(showRow||1)){img1.setAttribute("lazysrc",picSrc);img1.setAttribute("imgheight",imgheight+"")}else{kmap.imageHandle(img1,picSrc,75,imgheight)}kmap.dommouseact($s.$$(li,"a")[0],li.className,li.className+" rvr-atFbBg",$s.$$(li,"a")[0].parentNode.parentNode);if(linkurl&&addname&&maskFlag){var maskDiv=$s.$c("span",imgspan,"bg-black bg-black-hide"),maskLink=$s.$c("a",maskDiv,"pop-game");maskLink.href=linkurl;maskLink.target="_blank";maskLink.appendChild(document.createTextNode("进入下载"));(function(img,aL,mD){kmap.dommouseact(aL,"bg-black bg-black-hide","bg-black",mD);kmap.dommouseact(img,"bg-black bg-black-hide","bg-black",mD)}(imgspan,a,maskDiv))}}if(filteredNum==lens){entity_div.removeChild(ul);entity_div.removeChild(titleDiv)}else{buildFoldBtn({total:total,oriId:id,query:queryword,word:word,needLink:true,len:lens-filteredNum,titleDiv:titleDiv,row:showRow,div:ul})}}function getPoplength(spanDom){var content=spanDom.innerHTML;if(!content||content=="&nbsp;"){return 25}var length=(content+"").length;return 25+length*7}}function buildEnergyMap(obj,t){var h3=$s.$c("h3",entity_div,"rvr-atAdBranch"),type=parseInt(kmap.attr(obj,"type"))||0,title=kmap.attr(obj,"t").replace("|","<br>"),heat=parseFloat(kmap.tagtext(kmap.first(obj,"heat"))),h_list=[[24,38,66,77,87,82,71,59,45,33,26,32,26,22,17,19,13,16,19,13,6],[2,3,4,7,17,42,71,88,105,83,56,32,14,8,4,3,3,2,1,1,1],[2,3,4,7,27,72,82,96,75,33,12,8,4,3,2,3,3,2,1,1,1]],c_name=["fdGraphic","fdGraphic3","fdGraphic2"],step=[43,4.76,5.24],start=[0,140,140],div=$s.$c("div",entity_div,"fdGraphic_area"),c_div=$s.$c("div",div,c_name[type]);if(type>0){c_div.innerHTML='<div class="graphic_tit_area"><span class="graphic_tit">'+title+'</span><span class="graphic_mask"></span></div>'}else{c_div.innerHTML='<div class="fdGraphic_tit_area"><span class="fdGraphic_tit"><span>'+title+"</span></span><div>"}var ul=$s.$c("ul",c_div,"fdGraphic_lst");h3.innerHTML=t;var heat1=Math.floor((heat-start[type])/step[type]);if(heat1>20){heat1=20}for(var i=0;i<h_list[type].length;i++){var li=$s.$c("li",ul,(i==heat1)?"on":"");li.innerHTML='<span style="height:'+h_list[type][i]+'px"></span>'}}function buildNewsTimeline(newsdoc){var newsDiv,titleDiv,infoDiv,tmplink,hisDiv,eventsDiv;var title=kmap.tagtext(kmap.first(newsdoc,"title")),desc=kmap.tagtext(kmap.first(newsdoc,"description")),query=kmap.tagtext(kmap.first(newsdoc,"query"))||"",events=kmap.all(newsdoc,"event"),milestones,more_link;if(events.length<1){return }newsDiv=$s.$c("div",entity_div,"news-track-side");titleDiv=$s.$c("h3",newsDiv);more_link="http://news.sogou.com/news?query="+encodeURIComponent(query)+"&p=40330301";titleDiv.innerHTML=title+(query?'<a href="'+more_link+'" target="_blank"> (更多)</a>':"");if(desc){infoDiv=$s.$c("div",newsDiv,"news-info-text");infoDiv.innerHTML=desc}milestones=kmap.all(events[0],"milestone");buildTimeline(milestones,newsDiv,{main:true});if(events.length>1){hisDiv=$s.$c("div",newsDiv,"his_events");hisDiv.innerHTML='<span class="his_events_text">历史事件</span>'}for(var i=1;i<events.length;i++){eventsDiv=$s.$c("div",newsDiv,"eventsDiv");var unfoldBtn=$s.$c("a",eventsDiv),ul;unfoldBtn.setAttribute("hidefocus",true);unfoldBtn.style.outline="none";unfoldBtn.href="javascript:void(0)";unfoldBtn.innerHTML=kmap.attr(events[i],"title")+"<span id=kmap_event_unfold_"+i+">展开</span>";milestones=kmap.all(events[i],"milestone");ul=buildTimeline(milestones,newsDiv,{main:false});unfoldBtn.onclick=function(div,n){return function(){for(var idx=1;idx<events.length;idx++){var span=$s.$("kmap_event_unfold_"+idx);if(n==idx){span.style.display="none"}else{span.style.display=""}var uls=$s.$$(newsDiv,"ul");for(var i=1;i<uls.length;i++){uls[i].style.display="none"}div.style.display="";var lis=$s.$$($s.$("kmap_main_timeline"),"li");for(var i=3;i<lis.length-1;i++){lis[i].style.display="none"}lis[lis.length-1].style.display=""}}}(ul,i)}kmap.kmapPB("news_timeline","")}function formatTime(date,now){if(!date){return""}if(!now){return date2str(date,"yyyy-MM-dd hh:mm")}var t1=date.getTime()/1000,t2=now.getTime()/1000;if(t2-t1<60){return parseInt(t2-t1)+"秒前"}else{if(t2-t1<60*60){return parseInt((t2-t1)/60)+"分钟前"}else{if(t2-t1<60*60*24){return parseInt((t2-t1)/(60*60))+"小时前"}else{if(t2-t1<60*60*24*7){return parseInt((t2-t1)/(60*60*24))+"天前"}}}}return date2str(date,"yyyy-MM-dd hh:mm")}function buildTimeline(milestones,parent,options){var ul=$s.$c("ul",parent,"news-track"),lastyear="",now=new Date(window.now);if(options.main){ul.id="kmap_main_timeline"}options=options||{};for(var i=0;i<milestones.length;i++){var url=kmap.attr(milestones[i],"url")||"javascript:void(0)",title=kmap.attr(milestones[i],"title"),pubtime=kmap.attr(milestones[i],"pubtime"),type=kmap.attr(milestones[i],"nodetype"),source=kmap.attr(milestones[i],"source"),li,infoDiv,span,linkClass,date,year,shortTitle;date=new Date(Date.parse(pubtime.replace(/-/g,"/")));year=date.getFullYear();if(options.main&&year&&year!=lastyear&&lastyear&&i!=milestones.length){li=$s.$c("li",ul);li.innerHTML=year}lastyear=year;li=$s.$c("li",ul);span=$s.$c("span",li,"news-time");if(type=="4"&&options.main&&i<2){span.className+=" new-ico"}else{span.innerHTML=date2str(date,options.main?"MM-dd":"yyyy-MM")}infoDiv=$s.$c("div",li,"news-info");linkClass="news-title";if(type=="1"){linkClass="top-ico news-title"}else{if(type=="3"){linkClass="start-ico news-title"}}shortTitle=kmap.cutLength(title,(type=="1"||type=="3")?28:34);infoDiv.innerHTML='<a href="'+url+'" class="'+linkClass+'" target="_blank">'+title+'</a><a href="'+url+'" class="'+linkClass+'1024" target="_blank">'+shortTitle+"</a>";if(type=="4"&&options.main&&i<2){infoDiv.innerHTML+="<p>"+formatTime(date,now)+"</p>"}}if(options.main&&milestones.length>3){li=$s.$c("li",ul,"showLi");li.style.display="none";var unfoldBtn=$s.$c("a",li);unfoldBtn.href="javascript:void(0)";unfoldBtn.innerHTML="<span>展开</span>";unfoldBtn.onclick=function(){var lis=$s.$$(ul,"li");for(var i=0;i<lis.length;i++){lis[i].style.display=""}var uls=$s.$$(parent,"ul");for(var i=1;i<uls.length;i++){uls[i].style.display="none"}this.parentNode.style.display="none";var divs=$s.$$(parent,"div");for(var i=0;i<divs.length;i++){if(divs[i].className=="eventsDiv"){var spans=$s.$$(divs[i],"span");if(spans[0]){spans[0].style.display=""}}}}}if(!options.main){ul.style.display="none"}return ul}function getBusinessJson(){if(typeof (kmapBusiness)!="undefined"&&kmapBusiness){return kmap.xml2json(window.kmapBusiness.xml)}return null}function getBusinessNum(json){if(json){var elems=json.display.attribute.element;if(elems&&!(elems instanceof Array)){elems=[elems]}return elems.length}return 0}function buildBusinessEntity(json,position){if(!json){return }var attr=json.display.attribute,pvtype=json.pvtype||"";var businessTitle=buildTitle(attr.name);businessTitle.id="kmap_business_title";if(attr.name!="相关推广"){var titleSpan=$s.$$(businessTitle,"span");titleSpan[0].innerHTML+='<span class="business">&nbsp;-&nbsp;推广</span>'}var elems=attr.element;if(!(elems instanceof Array)){elems=[elems]}var ul=$s.$c("ul",entity_div,"rvr-atAdPiclist"),classname="rvr-atpic2",showRow=2,numPerRow=getColumNumPerRow(),lens=elems.length,total=lens<showRow*4?lens:showRow*4,wordStr=[];ul.id="kmap_business_ul";for(var i=0;i<total;i++){var li=$s.$c("li",ul),rep_div=$s.$c("div",li,"repDiv rep_Feed"),item=elems[i],attrname=item.name.replace(/&apos;/g,"'"),wholename=item.allname,addmess=item.add,adkid=item.adkid||"",addomainpicurl=item.addomainpicurl||"",wholequery=wholename?(wholename.replace(/&apos;/g,"'")):(attrname+(addmess?" "+addmess:"")),a,img;if(i>=numPerRow*(showRow)){li.style.display="none"}rep_div.style.marginBottom="5px";var wronga=kmap.feedlink(rep_div,"rvr-atReport","","纠错",true,true);wronga.id="sgkmap_business_"+pvtype+"_"+i+"_wrong";wronga.setAttribute("con",attrname);var imgspan=$s.$c("a",li,classname);imgspan.id=["sgkmap_business",position,pvtype,encodeURIComponent(attrname),i+1,total,adkid].join("_");var linkurl=item.adurl||"";if(!linkurl){linkurl=kmap.splicelink(wholequery)}imgspan.href=linkurl;imgspan.target="_blank";a=$s.$c("a",li);a.href=linkurl;a.target="_blank";a.id=["sgkmap_business",position,pvtype,encodeURIComponent(attrname),i+1,total,adkid].join("_");img=$s.$c("img",imgspan);if(wholename){a.title=wholename.replace(/&apos;/g,"'");img.title=wholename.replace(/&apos;/g,"'")}var aspan=$s.$c("span",a,"kmap-title");aspan.innerHTML=kmap.cutLength(attrname,24);if(addomainpicurl){imgspan.className+=" kmap-adds-logo-atag";var logoSpan=$s.$c("span",imgspan,"kmap-adds-logo"),logoImg=$s.$c("img",logoSpan);kmap.imageHandle(logoImg,addomainpicurl,16,16)}if(i>=numPerRow*(showRow||1)){img.setAttribute("lazysrc",item.picaddress)}else{kmap.imageHandle(img,item.picaddress,75,75)}kmap.dommouseact($s.$$(li,"a")[0],li.className,li.className+" rvr-atFbBg",$s.$$(li,"a")[0].parentNode.parentNode);wordStr.push(attrname);businessMap[attrname]=true}var kmap_timeout=-1;var changeDiv=(function(div,row){return function(){if(kmap_timeout!=-1){clearTimeout(kmap_timeout)}kmap_timeout=setTimeout(function(){if(div){var lis=$s.$$(div,"li"),showNum=getColumNumPerRow()*row;for(var i=0;i<showNum&&i<lis.length;i++){var liImg=$s.$$(lis[i],"img")[0];if(liImg.getAttribute("lazysrc")){kmap.imageHandle(liImg,liImg.getAttribute("lazysrc"),75,75);liImg.removeAttribute("lazysrc")}lis[i].style.display=""}for(var i=showNum;i<lis.length;i++){lis[i].style.display="none"}}kmap_timeout=-1},100)}})(ul,showRow);if(!$s.ua.ios&&!$s.ua.and){$s.$b(window,["resize"],[changeDiv])}kmap.kmapPB("kmap_business_"+position,"&count="+total+"&words="+encodeURIComponent(wordStr.join("+")))}function removeClass(obj,c){obj.className=obj.className.replace(c,"")}function addClass(obj,c){obj.className=obj.className+" "+c}function feedBackAssign(n,isRelation){if(!$s.$("kmap_entity_div")){return }var div=$s.$c("div",$s.$("kmap_entity_div"),"rvr-feedBack"),span1=$s.$c("span",div,"fr");div.id="tp_fb_bcl";span1.innerHTML='<a id="sgkmap_right_report" href="#" class="fb">反馈</a>';var div=$s.$c("div",$s.$("kmap_entity_div"),"rvr-crtFeedBack"),span=$s.$c("span",div),span1=$s.$c("span",div,"fr");div.style.display="none";div.id="tp_fb_acl";div.innerHTML='若以上内容有误，点击相应的“纠错”提交；其他问题，请直接点击 <a class="fb" href="#">反馈</a> <a class="cc" href="#">取消</a>';var areportas=$s.$$(entity_div,"a"),j=0,reportas=[],uls=[];for(;j<areportas.length;j++){if(areportas[j].className=="rvr-atReport"){reportas.push(areportas[j]);areportas[j].onclick=function(){showOrHide(true);var isParent=false;if(this.style.display=="none"){this.style.display=""}else{isParent=true;this.parentNode.style.display=""}var div=$s.$c("div",document.body,"atThanks"),pos=kmap.pos(this);div.innerHTML="感谢您的反馈";div.style.top=pos[1]+"px";div.style.left=(pos[0]-40)+"px";if(isParent){this.parentNode.style.display="none"}else{this.style.display="none"}$s.$("tp_fb_bcl").style.display="";$s.$("tp_fb_acl").style.display="none";$s.$$($s.$("tp_fb_bcl"),"a")[0].innerHTML="谢谢！继续反馈";$s.$$($s.$("tp_fb_bcl"),"a")[0].className="";if(isRelation){removeClass(tagDiv,"correction")}showcatoon(div,pos[1],0.1);kmap.tupudissatisfied("tupufankuiform","kmap_entity_div",this.getAttribute("con"));return false}}}function showcatoon(divelem,top,opacity){var divtop=parseInt(divelem.style.top.replace("px",""));if(divtop>top-40){divelem.style.top=(divtop-2)+"px";divelem.style.opacity=opacity;if(divtop==top-20){setTimeout(function(){showcatoon(divelem,top,0.9)},800)}else{setTimeout(function(){showcatoon(divelem,top,(divtop>top-20)?opacity+0.1:opacity-0.1)},50)}}else{divelem.outerHTML=""}}function showOrHide(isHide){for(j=0;j<reportas.length;j++){if(reportas[j].parentNode.tagName.toLowerCase()=="div"&&reportas[j].parentNode.className.indexOf("rep_Feed")!=-1){reportas[j].parentNode.style.display=isHide?"none":displayname}else{reportas[j].style.display=isHide?"none":displayname}}}var tagDiv=$s.$$($s.$("tp_fb_bcl").parentNode,"div")[0];$s.$$($s.$("tp_fb_bcl"),"a")[0].onclick=function(){displayAll(reportas,true);if(isRelation){addClass(tagDiv,"correction")}$s.$("tp_fb_bcl").style.display="none";$s.$("tp_fb_acl").style.display="";return false};$s.$$($s.$("tp_fb_acl"),"a")[0].onclick=function(){kmap.tupudissatisfied("tupufankuiform","kmap_entity_div",n);$s.$$($s.$("tp_fb_bcl"),"a")[0].innerHTML="谢谢！继续反馈";$s.$$($s.$("tp_fb_bcl"),"a")[0].className="";$s.$("tp_fb_bcl").style.display="";$s.$("tp_fb_acl").style.display="none";if(isRelation){removeClass(tagDiv,"correction")}displayAll(reportas);return false};$s.$$($s.$("tp_fb_acl"),"a")[1].onclick=function(){$s.$("tp_fb_bcl").style.display="";$s.$("tp_fb_acl").style.display="none";if(isRelation){removeClass(tagDiv,"correction")}displayAll(reportas);return false}}function displayAll(rs,isShow){var i=0;for(;i<rs.length;i++){if(rs[i].parentNode.className.indexOf("rep_Feed")!=-1){rs[i].parentNode.style.display=isShow?"block":"none"}else{rs[i].style.display=isShow?"":"none"}}}function init(){entity_div.innerHTML="";if(window.rightVrView&&window.rightVrView=="1024"){right_div.className+=" kmap-vr1024"}if(!kmap_properties.right.kmap_dom){buildBusinessEntity(getBusinessJson(),"up");hasContent=true}else{kmap_stas_type_cl=kmap_properties.right.type+"_"+kmap_properties.right.attr+"_"+kmap_properties.right.showtype;var hasContent=false,hasTimeline=false;var entityid=kmap.attr(kmap_properties.right.entity,"id"),entityname=kmap.attr(kmap_properties.right.entity,"name"),attributes=kmap_properties.right.kmap_dom.getElementsByTagName("attribute"),lenattr=attributes.length,entity=kmap_properties.right.entity;var storydoc=kmap.first(kmap_properties.right.kmap_dom,"storydoc");hasTimeline=storydoc&&kmap.attr(storydoc,"type")=="1";var relation=kmap_properties.right.kmap_dom.getElementsByTagName("relation")[0];relation=kmap.tagtxt(relation);if(relation){buildRelation(relation)}if(hasTimeline){buildNewsTimeline(storydoc)}var businessJson=getBusinessJson(),businessNum=getBusinessNum(businessJson),businessPosition="none";if(businessNum>=3){businessPosition="up"}else{if(businessNum>0){businessPosition="down"}}buildBusinessEntity(businessJson,businessPosition);if(lenattr>0){if(rightVr&&lenattr>3){lenattr=3}if(hasTimeline&&lenattr>2){lenattr=2}var showMaskList=[true,true,true];if(lenattr==3){if(kmap.attr(attributes[0],"addname")&&!kmap.attr(attributes[1],"addname")&&kmap.attr(attributes[2],"addname")){showMaskList=[true,false,false]}else{if(!kmap.attr(attributes[0],"addname")&&kmap.attr(attributes[1],"addname")&&!kmap.attr(attributes[2],"addname")){showMaskList=[false,false,false]}}}for(var i=0;i<lenattr;i++){var attrtitle=attributes[i].getAttribute("name"),total=attributes[i].getAttribute("total"),word=attributes[i].getAttribute("word"),requery=kmap.attr(attributes[i],"requery"),stattype=kmap.attr(attributes[i],"stattype");if(!stattype){stattype="unknown"}statTypeList.push("_",stattype,"-",i);stattype=(stattype)?"content_"+stattype:"content";if(attrtitle){buildKmapList(attributes[i],i,attrtitle,word,entityid,entityname,total,stattype,requery,showMaskList[i],businessPosition)}}hasContent=true}if(businessPosition=="down"){var businessTitle=$s.$("kmap_business_title"),businessUl=$s.$("kmap_business_ul");if(businessTitle){entity_div.appendChild(businessTitle)}if(businessUl){entity_div.appendChild(businessUl)}}kmap.kmapPB("right","&pvarg="+kmap_stas_type+"&attr="+statTypeList.join("")+"&cooperation="+cooperation)}if(entity_div&&entity_div.innerHTML){entity_div.style.display=""}else{entity_div.outerHTML=""}if($s.$("kmap_entity_div")){var entityChild=$s.$("kmap_entity_div").firstChild;if(entityChild&&entityChild.className=="rvr-atAdBranch"){entityChild.style.marginTop="0px"}}if(hasContent){feedBackAssign(entityname)}if(hasContent||hasTimeline){setTimeout(cutAds,500)}}function cutAds(){kmap.cutAds();kmap.cutRankList($s.$("kmap_right_ranklist"));kmap.cutQueryList($s.$("kmap_right_querylist"));kmap.cutRecommendKmap()}function date2str(x,y){var z={y:x.getFullYear(),M:x.getMonth()+1,d:x.getDate(),h:x.getHours(),m:x.getMinutes(),s:x.getSeconds()};return y.replace(/(y+|M+|d+|h+|m+|s+)/g,function(v){return((v.length>1?"0":"")+eval("z."+v.slice(-1))).slice(-(v.length>2?v.length:2))})}function getColumNumPerRow(){if(window.rightVrView&&window.rightVrView=="1024"){return 3}return $s.viewport().width<1200?3:4}init();kmap.leftDone=new Date().getTime();kmap.speedStat("right")})});